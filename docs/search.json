[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Posts",
    "section": "",
    "text": "Date\n\n\nTitle\n\n\nAuthor\n\n\n\n\n\n\nSep 30, 2022\n\n\nExplore data\n\n\nRenato Hermoza\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "nbs/30092022_explore-data.html",
    "href": "nbs/30092022_explore-data.html",
    "title": "Explore data",
    "section": "",
    "text": "Last execution time: 06/03/2023 05:44:10\n\n\n\n\nCode\nexplore_types = ['frutas', 'lacteos', 'verduras', 'embutidos', 'panaderia', 'desayuno', 'congelados', 'abarrotes',\n                 'aves', 'carnes', 'pescados']\n\n\n\n\nCode\npath = Path('../../output')\ncsv_files = L(path.glob('*.csv')).filter(lambda o: os.stat(o).st_size>0)\npat_store = re.compile('(.+)\\_\\d+')\npat_date = re.compile('.+\\_(\\d+)')\ndf = (\n    pd.concat([pd.read_csv(o).assign(store=pat_store.match(o.stem)[1], date=pat_date.match(o.stem)[1])\n               for o in csv_files], ignore_index=True)\n    .pipe(lambda d: d.assign(\n        name=d.name.str.lower()+' ('+d.store+')',\n        sku=d.id.where(d.sku.isna(), d.sku).astype(int),\n        date=pd.to_datetime(d.date)\n    ))\n    .drop('id', axis=1)\n    .loc[lambda d: d.category.str.contains('|'.join(explore_types))]\n    # Filter products with recent data\n    .loc[lambda d: d.name.isin(d.groupby('name').date.max().loc[ge(datetime.now()-timedelta(days=30))].index)]\n    # Filter empty prices\n    .loc[lambda d: d.price>0]\n)\nprint(df.shape)\ndf.sample(3)\n\n\n(319396, 8)\n\n\n\n\n\nData table\n  \n    \n      \n      brand\n      uri\n      name\n      price\n      category\n      store\n      date\n      sku\n    \n  \n  \n    \n      82567\n      Emporio\n      https://www.metro.pe/aguaymanto-fresco-pelado-...\n      aguaymanto fresco pelado emporio 200g (metro)\n      3.99\n      https://www.metro.pe/frutas-y-verduras/frutas/...\n      metro\n      2023-02-20\n      2801\n    \n    \n      362190\n      BELL'S\n      https://www.plazavea.com.pe/pulpa-de-cangrejo-...\n      pulpa de cangrejo bell's bolsa 200g (plaza_vea)\n      29.90\n      https://www.plazavea.com.pe/carnes-aves-y-pesc...\n      plaza_vea\n      2023-02-23\n      10268\n    \n    \n      314070\n      GOLD COFFEE\n      https://www.plazavea.com.pe/cafe-gourmet-premi...\n      café gourmet premium gold coffee 250g (plaza_vea)\n      21.69\n      https://www.plazavea.com.pe/desayunos\n      plaza_vea\n      2023-01-30\n      10753113\n    \n  \n\n\n\n\n\n\nCode\ntop_changes = (df\n .loc[lambda d: ~d.name.isin([\n     'sillau #06 kikko botella 350 ml (metro)',\n     'sillau kikko botella 500 ml (metro)',\n     'salsa de soya con ajo y kión kikko 350ml (metro)'\n ])]\n # Use last 90 days of data\n .loc[lambda d: d.date>=(datetime.now()-timedelta(days=90))]\n .sort_values('date')\n # Get percentage change\n .pipe(lambda d: d.assign(**d\n     .groupby(['store','sku'], as_index=False)\n     .price\n     .transform(lambda d: (d-d.shift())/d.shift())\n     .loc[:,['price']]\n ))\n .groupby(['store','sku'], as_index=False)\n .price.mean()\n .rename({'price': 'change'}, axis=1)\n .dropna()\n .loc[lambda d: d.change.abs().sort_values(ascending=False).index]\n)\ntop_changes.head()\n\n\n\n\n\n\n  \n    \n      \n      store\n      sku\n      change\n    \n  \n  \n    \n      3934\n      metro\n      1017225\n      1.058824\n    \n    \n      3935\n      metro\n      1017226\n      0.700319\n    \n    \n      2525\n      metro\n      564388\n      -0.438596\n    \n    \n      6876\n      plaza_vea\n      62784\n      0.263158\n    \n    \n      6674\n      plaza_vea\n      50027\n      0.204990\n    \n  \n\n\n\n\n\n\nCode\n(top_changes\n .head(10)\n .drop('change', axis=1)\n .merge(df, on=['store','sku'])\n .pipe(alt.Chart)\n .mark_line(point=True)\n .encode(x='date', y='price', color='name', tooltip=['name','price'])\n .properties(width=650, title='Top changes')\n .configure_legend(orient='top', columns=3)\n)\n\n\n\n\n\n\n\n\n\nCode\n(top_changes\n .sort_values('change')\n .head(10)\n .loc[:, ['store','sku']]\n .merge(df, on=['store','sku'])\n .pipe(alt.Chart)\n .mark_line(point=True)\n .encode(x='date', y='price', color='name', tooltip=['name','price'])\n .properties(width=650, title='Top drops')\n .configure_legend(orient='top', columns=3)\n)\n\n\n\n\n\n\n\n\n\nCode\n(top_changes\n .sort_values('change')\n .tail(10)\n .loc[:, ['store','sku']]\n .merge(df, on=['store','sku'])\n .pipe(alt.Chart)\n .mark_line(point=True)\n .encode(x='date', y='price', color='name', tooltip=['name','price'])\n .properties(width=650, title='Top increases')\n .configure_legend(orient='top', columns=3)\n)\n\n\n\n\n\n\n\n\n\n\nCode\n(df\n .loc[df.name.isin(names)]\n .pipe(alt.Chart)\n .mark_line(point=True)\n .encode(x='date', y='price', color='name', tooltip=['name','price'])\n .properties(width=650, title='Pollo')\n .configure_legend(orient='top', columns=3)\n)\n\n\n\n\n\n\n\n\n\nCode\n(df\n .loc[df.name.isin(names)]\n .pipe(alt.Chart)\n .mark_line(point=True)\n .encode(x='date', y='price', color='name', tooltip=['name','price'])\n .properties(width=650, title='Palta')\n .configure_legend(orient='top', columns=3)\n)\n\n\n\n\n\n\n\n\n\nCode\n(df\n .loc[df.name.isin(names)]\n .pipe(alt.Chart)\n .mark_line(point=True)\n .encode(x='date', y='price', color='name', tooltip=['name','price'])\n .properties(width=650, title='Aceite')\n .configure_legend(orient='top', columns=3)\n)\n\n\n\n\n\nAceite vegeta"
  }
]