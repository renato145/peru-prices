[
  {
    "objectID": "nbs/30092022_explore-data.html",
    "href": "nbs/30092022_explore-data.html",
    "title": "Explore data",
    "section": "",
    "text": "Last execution time: 15/05/2025 05:44:08\n\n\n\n\nProducts type filter\nexplore_types = ['frutas', 'lacteos', 'verduras', 'embutidos', 'panaderia', 'desayuno', 'congelados', 'abarrotes',\n                 'aves', 'carnes', 'pescados']\n\n\n\n\nData table\npath = Path('../../output')\ncsv_files = L(path.glob('*.csv')).filter(lambda o: os.stat(o).st_size&gt;0)\npat_store = re.compile('(.+)\\_\\d+')\npat_date = re.compile('.+\\_(\\d+)')\ndf = (\n    pd.concat([pd.read_csv(o).assign(store=pat_store.match(o.stem)[1], date=pat_date.match(o.stem)[1])\n               for o in csv_files], ignore_index=True)\n    .pipe(lambda d: d.assign(\n        name=d.name.str.lower()+' ('+d.store+')',\n        sku=d.id.where(d.sku.isna(), d.sku).astype(int),\n        date=pd.to_datetime(d.date)\n    ))\n    .drop('id', axis=1)\n    .loc[lambda d: d.category.str.contains('|'.join(explore_types))]\n    # Filter products with recent data\n#     .loc[lambda d: d.name.isin(d.groupby('name').date.max().loc[ge(datetime.now()-timedelta(days=30))].index)]\n    # Filter empty prices\n    .loc[lambda d: d.price&gt;0]\n)\nprint(df.shape)\ndf.sample(3)\n\n\n(1390254, 8)\n\n\n\n\n\n\n\n\n\nsku\nname\nbrand\ncategory\nuri\nprice\nstore\ndate\n\n\n\n\n1992231\n86006\nbutter toffees arcor surtido bolsa 400g (plaza...\nARCOR\nhttps://www.plazavea.com.pe/abarrotes\nhttps://www.plazavea.com.pe/toffees-arcor-butt...\n15.9\nplaza_vea\n2024-08-15\n\n\n1904579\n10020923\nchicha de jora lorenza botella 500ml (plaza_vea)\nLORENZA\nhttps://www.plazavea.com.pe/abarrotes\nhttps://www.plazavea.com.pe/chicha-de-jora-lor...\n11.1\nplaza_vea\n2025-03-27\n\n\n3421398\n15164\naceite de oliva carbonell puro frasco 200ml (p...\nCARBONELL\nhttps://www.plazavea.com.pe/abarrotes\nhttps://www.plazavea.com.pe/aceite-de-oliva-ca...\n16.9\nplaza_vea\n2023-06-19"
  },
  {
    "objectID": "nbs/30092022_explore-data.html#get-data",
    "href": "nbs/30092022_explore-data.html#get-data",
    "title": "Explore data",
    "section": "",
    "text": "Last execution time: 15/05/2025 05:44:08\n\n\n\n\nProducts type filter\nexplore_types = ['frutas', 'lacteos', 'verduras', 'embutidos', 'panaderia', 'desayuno', 'congelados', 'abarrotes',\n                 'aves', 'carnes', 'pescados']\n\n\n\n\nData table\npath = Path('../../output')\ncsv_files = L(path.glob('*.csv')).filter(lambda o: os.stat(o).st_size&gt;0)\npat_store = re.compile('(.+)\\_\\d+')\npat_date = re.compile('.+\\_(\\d+)')\ndf = (\n    pd.concat([pd.read_csv(o).assign(store=pat_store.match(o.stem)[1], date=pat_date.match(o.stem)[1])\n               for o in csv_files], ignore_index=True)\n    .pipe(lambda d: d.assign(\n        name=d.name.str.lower()+' ('+d.store+')',\n        sku=d.id.where(d.sku.isna(), d.sku).astype(int),\n        date=pd.to_datetime(d.date)\n    ))\n    .drop('id', axis=1)\n    .loc[lambda d: d.category.str.contains('|'.join(explore_types))]\n    # Filter products with recent data\n#     .loc[lambda d: d.name.isin(d.groupby('name').date.max().loc[ge(datetime.now()-timedelta(days=30))].index)]\n    # Filter empty prices\n    .loc[lambda d: d.price&gt;0]\n)\nprint(df.shape)\ndf.sample(3)\n\n\n(1390254, 8)\n\n\n\n\n\n\n\n\n\nsku\nname\nbrand\ncategory\nuri\nprice\nstore\ndate\n\n\n\n\n1992231\n86006\nbutter toffees arcor surtido bolsa 400g (plaza...\nARCOR\nhttps://www.plazavea.com.pe/abarrotes\nhttps://www.plazavea.com.pe/toffees-arcor-butt...\n15.9\nplaza_vea\n2024-08-15\n\n\n1904579\n10020923\nchicha de jora lorenza botella 500ml (plaza_vea)\nLORENZA\nhttps://www.plazavea.com.pe/abarrotes\nhttps://www.plazavea.com.pe/chicha-de-jora-lor...\n11.1\nplaza_vea\n2025-03-27\n\n\n3421398\n15164\naceite de oliva carbonell puro frasco 200ml (p...\nCARBONELL\nhttps://www.plazavea.com.pe/abarrotes\nhttps://www.plazavea.com.pe/aceite-de-oliva-ca...\n16.9\nplaza_vea\n2023-06-19"
  },
  {
    "objectID": "nbs/30092022_explore-data.html#top-changes-ratio",
    "href": "nbs/30092022_explore-data.html#top-changes-ratio",
    "title": "Explore data",
    "section": "Top changes (ratio)",
    "text": "Top changes (ratio)\n\n\nCode\ntop_changes = (df\n # Use last 30 days of data to compare prices\n .loc[lambda d: d.date&gt;=(datetime.now()-timedelta(days=30))]\n .sort_values('date')\n # Get percentage change\n .assign(change=lambda d: d\n     .groupby(['store','sku'], as_index=False)\n     .price.transform(lambda d: (d-d.shift())/d.shift())\n )\n .groupby(['store','sku'], as_index=False)\n .agg({'price':'last', 'change':'mean', 'date':'last'})\n .rename({'price':'last_price', 'date':'last_date'}, axis=1)\n .dropna()\n .loc[lambda d: d.last_date==d.last_date.max()]\n .loc[lambda d: d.change.abs().sort_values(ascending=False).index]\n)\ntop_changes.head(3)\n\n\n\n\n\n\n\n\n\nstore\nsku\nlast_price\nchange\nlast_date\n\n\n\n\n6117\nplaza_vea\n11810004\n3.9\n-0.434783\n2025-05-15\n\n\n4924\nplaza_vea\n11339752\n19.0\n0.220297\n2025-05-15\n\n\n1190\nplaza_vea\n9552\n4.9\n0.184224\n2025-05-15\n\n\n\n\n\n\n\n\n\nCode\ndef plot_changes(df_changes, title):\n    selection = alt.selection_point(fields=['name'], bind='legend')\n    dff = df_changes.drop('change', axis=1).merge(df, on=['store','sku'])\n    return (dff\n     .pipe(alt.Chart)\n     .mark_line(point=True)\n     .encode(\n         x='date',\n         y='price',\n         color=alt.Color('name').scale(domain=sorted(dff.name.unique().tolist())),\n         tooltip=['name','price','last_price']\n     )\n     .add_params(selection)\n     .transform_filter(selection)\n     .interactive()\n     .properties(width=650, title=title)\n     .configure_legend(orient='top', columns=3)\n    )\n\n\n\n\nCode\ntop_changes.head(10).pipe(plot_changes, 'Top changes')\n\n\n\n\n\n\n\n\n\n\nCode\n(top_changes\n .sort_values('change')\n .head(10)\n .pipe(plot_changes, 'Top drops')\n)\n\n\n\n\n\n\n\n\n\n\nCode\n(top_changes\n .sort_values('change')\n .tail(10)\n .pipe(plot_changes, 'Top increases')\n)"
  },
  {
    "objectID": "nbs/30092022_explore-data.html#top-changes-absolute-values",
    "href": "nbs/30092022_explore-data.html#top-changes-absolute-values",
    "title": "Explore data",
    "section": "Top changes (absolute values)",
    "text": "Top changes (absolute values)\n\n\nCode\ntop_changes_abs = (df\n # Use last 30 days of data to compare prices\n .loc[lambda d: d.date&gt;=(datetime.now()-timedelta(days=30))]\n .sort_values('date')\n # Get percentage change\n .assign(change=lambda d: d\n     .groupby(['store','sku'], as_index=False)\n     .price.transform(lambda d: (d-d.shift()).iloc[-1])\n )\n .groupby(['store','sku'], as_index=False)\n .agg({'price':'last', 'change':'mean', 'date':'last'})\n .rename({'price':'last_price', 'date':'last_date'}, axis=1)\n .dropna()\n .loc[lambda d: d.last_date==d.last_date.max()]\n .loc[lambda d: d.change.abs().sort_values(ascending=False).index]\n)\ntop_changes_abs.head(3)\n\n\n\n\n\n\n\n\n\nstore\nsku\nlast_price\nchange\nlast_date\n\n\n\n\n6089\nplaza_vea\n11795909\n34.9\n-22.0\n2025-05-15\n\n\n4875\nplaza_vea\n11309140\n29.9\n-20.0\n2025-05-15\n\n\n2665\nplaza_vea\n10023364\n16.9\n-13.0\n2025-05-15\n\n\n\n\n\n\n\n\n\nCode\ntop_changes_abs.head(10).pipe(plot_changes, 'Top changes')\n\n\n\n\n\n\n\n\n\n\nCode\n(top_changes_abs\n .sort_values('change')\n .head(10)\n .pipe(plot_changes, 'Top drops')\n)\n\n\n\n\n\n\n\n\n\n\nCode\n(top_changes_abs\n .sort_values('change')\n .tail(10)\n .pipe(plot_changes, 'Top increases')\n)"
  },
  {
    "objectID": "nbs/30092022_explore-data.html#search-specific-products",
    "href": "nbs/30092022_explore-data.html#search-specific-products",
    "title": "Explore data",
    "section": "Search specific products",
    "text": "Search specific products\n\n\nCode\n(df\n .loc[df.name.isin(names)]\n .pipe(alt.Chart)\n .mark_line(point=True)\n .encode(x='date', y='price', color='name', tooltip=['name','price'])\n .properties(width=650, title='Pollo')\n .interactive()\n .configure_legend(orient='top', columns=3)\n)\n\n\n\n\n\n\n\n\n\n\nCode\n(df\n .loc[df.name.isin(names)]\n .pipe(alt.Chart)\n .mark_line(point=True)\n .encode(x='date', y='price', color='name', tooltip=['name','price'])\n .properties(width=650, title='Palta')\n .interactive()\n .configure_legend(orient='top', columns=3)\n)\n\n\n\n\n\n\n\n\n\n\nCode\n(df\n .loc[df.name.isin(names)]\n .pipe(alt.Chart)\n .mark_line(point=True)\n .encode(x='date', y='price', color='name', tooltip=['name','price'])\n .properties(width=650, title='Aceite')\n .interactive()\n .configure_legend(orient='top', columns=3)\n)\n\n\n\n\n\n\n\n\n\n\nCode\n(df\n .loc[df.name.isin(names)]\n .pipe(alt.Chart)\n .mark_line(point=True)\n .encode(x='date', y='price', color='name', tooltip=['name','price'])\n .properties(width=650, title='Aceite')\n .interactive()\n .configure_legend(orient='top', columns=3)\n)\n\n\n\n\n\n\n\n\n\n\nCode\n(df\n .loc[df.name.isin(names)]\n .pipe(alt.Chart)\n .mark_line(point=True)\n .encode(x='date', y='price', color='name', tooltip=['name','price'])\n .properties(width=650, title='Aceite')\n .interactive()\n .configure_legend(orient='top', columns=3)\n)"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Posts",
    "section": "",
    "text": "Date\n\n\n\nTitle\n\n\n\nAuthor\n\n\n\n\n\n\n\n\nSep 30, 2022\n\n\nExplore data\n\n\nRenato Hermoza\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "index.html#notebooks",
    "href": "index.html#notebooks",
    "title": "Posts",
    "section": "",
    "text": "Date\n\n\n\nTitle\n\n\n\nAuthor\n\n\n\n\n\n\n\n\nSep 30, 2022\n\n\nExplore data\n\n\nRenato Hermoza\n\n\n\n\n\n\nNo matching items"
  }
]